<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">

</html>

<head>
    <title>비동기처리</title>
</head>
<style>
    * {
        padding: 5px;
    }
</style>

<body>
    <form>
        <select id="user-select">
            <option value="">유저를 선택하세요</option>
        </select>
        <input id="user-name" placeholder="이름을 입력하세요">
        <input id="user-email" placeholder="이메일을 입력하세요">
        <button id="button" type="button">저장</button>
    </form>
</body>
<script>
    async function readusers() {
        const res = await fetch("https://jsonplaceholder.typicode.com/users");
        const data = await res.json();
        const user_select = document.getElementById('user-select');
        const user_name = document.getElementById('user-name');
        const user_email = document.getElementById('user-email');
        data.forEach(user => {
            const option = document.createElement('option');
            option.value = user.id;
            option.textContent = `${user.name} (${user.email})`;
            user_select.appendChild(option);
        });

        user_select.addEventListener('change', async (e) => {
            const userId = e.target.value;
            if (!userId) {
                return;
            }
            const res = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`)
            const data = await res.json();
            user_name.value = data.name;
            user_email.value = data.email;
        });

        const button = document.getElementById('button');
        button.addEventListener('click', async () => {
            const name = user_name.value.trim();
            const email = user_email.value.trim();
            const userId = user_select.value;

            if (!userId || !name || !email) {
                alert("유저를 선택해주시고, 이름과 이메일을 모두 입력해주세요");
                return;
            }
            const res = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ name, email })
            });
            const result = await res.json();
            console.log('PUT 결과: ', result);
            alert(`새 유저 등록 완료!\nID: ${result.id}\n이름: ${result.name}`);

        })
    }
    readusers();


</script>